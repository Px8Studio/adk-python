# ============================================================================
# MCP Tool Configuration for DNB APIs
# ============================================================================
# Documentation: https://googleapis.github.io/genai-toolbox/
# DNB API Portal: https://api.portal.dnb.nl/

# =============================================================================
# SOURCES - DNB API Connections
# =============================================================================

sources:
  # Base DNB API source (environment-aware)
  dnb-api-base:
    kind: http
    baseUrl: https://api.portal.dnb.nl
    timeout: 30s
    headers:
      # Conditional selection based on DNB_ENVIRONMENT
      # If DNB_ENVIRONMENT=prod, use PROD key; otherwise use DEV key
      Ocp-Apim-Subscription-Key: ${DNB_SUBSCRIPTION_KEY_${DNB_ENVIRONMENT:dev}}
      X-Subscription-Name: ${DNB_SUBSCRIPTION_NAME_${DNB_ENVIRONMENT:dev}}
      Accept: application/json
      User-Agent: Orkhon-GenAI-Toolbox/1.0
    # DNB rate limit: 30 calls/min per subscription
    rateLimitPerMinute: 30

# =============================================================================
# TOOLS - DNB API Endpoints
# =============================================================================

tools:
  # ---------------------------------------------------------------------------
  # DNB Echo API - Test endpoint
  # ---------------------------------------------------------------------------
  dnb-echo-test:
    kind: http
    source: dnb-api-base
    method: GET
    path: /echo
    description: |
      Test the DNB API connection and authentication.
      Returns an echo of the request to verify connectivity.
      Use this tool to validate your API key and subscription.
    parameters:
      message:
        type: string
        description: Test message to echo back
        default: "Hello from Orkhon"
    queryParams:
      message: ${message}

  # ---------------------------------------------------------------------------
  # DNB Statistics API - v2024100101
  # ---------------------------------------------------------------------------
  dnb-statistics-query:
    kind: http
    source: dnb-api-base
    method: GET
    path: /statistics/v2024100101/data
    description: |
      Query DNB statistical data on the Dutch financial sector and balance of payments.
      Enables policy makers, researchers, and analysts to monitor financial developments.
      
      Example queries:
      - Banking sector statistics
      - Payment system data
      - Financial stability indicators
    parameters:
      dataset:
        type: string
        description: Dataset identifier (e.g., 'banking-sector', 'payment-systems')
        required: true
      filters:
        type: string
        description: JSON string with filter criteria (e.g., '{"year":"2024","quarter":"Q1"}')
        required: false
      limit:
        type: integer
        description: Maximum number of results (1-100)
        default: 50
      offset:
        type: integer
        description: Pagination offset
        default: 0
    queryParams:
      dataset: ${dataset}
      filters: ${filters}
      limit: ${limit}
      offset: ${offset}

  dnb-statistics-metadata:
    kind: http
    source: dnb-api-base
    method: GET
    path: /statistics/v2024100101/metadata
    description: |
      Retrieve metadata about available DNB statistical datasets.
      Returns information about data structure, available filters, and update frequency.
    parameters:
      dataset:
        type: string
        description: Optional dataset ID to get specific metadata
        required: false
    queryParams:
      dataset: ${dataset}

  # ---------------------------------------------------------------------------
  # Public Register API - v1
  # ---------------------------------------------------------------------------
  dnb-public-register-search:
    kind: http
    source: dnb-api-base
    method: GET
    path: /public-register/v1/organizations
    description: |
      Search the DNB public register for licensed financial organizations.
      
      Use cases:
      - Check if a bank has a valid license
      - Verify crypto company registration
      - Search for specific financial service providers
      
      More info: https://www.dnb.nl/en/public-register/
    parameters:
      name:
        type: string
        description: Organization name (partial match supported)
        required: false
      license_type:
        type: string
        description: Filter by license type (e.g., 'bank', 'crypto', 'investment-firm')
        required: false
      status:
        type: string
        description: License status ('active', 'revoked', 'expired')
        default: "active"
      limit:
        type: integer
        description: Results per page (1-100)
        default: 20
      offset:
        type: integer
        description: Pagination offset
        default: 0
    queryParams:
      name: ${name}
      license_type: ${license_type}
      status: ${status}
      limit: ${limit}
      offset: ${offset}

  dnb-public-register-get-org:
    kind: http
    source: dnb-api-base
    method: GET
    path: /public-register/v1/organizations/${organization_id}
    description: |
      Get detailed information about a specific organization in the DNB public register.
      Returns full license details, contact information, and regulatory status.
    parameters:
      organization_id:
        type: string
        description: Unique organization identifier from DNB register
        required: true

  # ---------------------------------------------------------------------------
  # Health & Monitoring
  # ---------------------------------------------------------------------------
  dnb-api-health:
    kind: http
    source: dnb-api-base
    method: GET
    path: /health
    description: |
      Check DNB API service health and availability.
      Returns API status, version, and rate limit information.